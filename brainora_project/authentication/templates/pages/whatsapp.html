{% extends 'base.html' %}
{% load static %}

{% block title %}Connect on WhatsApp - Brainora{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-6">
            <!-- Header Section -->
            <div class="text-center mb-5">
                <div style="font-size: 4rem; color: #25D366; margin-bottom: 1.5rem;">
                    <i class="fab fa-whatsapp"></i>
                </div>
                <h1 class="mb-2">Connect With Us</h1>
                <p class="lead text-muted">Join our WhatsApp community for updates, announcements, and direct support</p>
            </div>

            <!-- WhatsApp Options Cards -->
            <div class="row g-4 mb-5">
                <!-- WhatsApp Group Card -->
                <div class="col-md-6">
                    <div class="card whatsapp-card h-100 border-0 shadow-sm hover-lift" style="cursor: pointer;">
                        <div class="card-body text-center py-5">
                            <div style="font-size: 3rem; color: #25D366; margin-bottom: 1rem;">
                                <i class="fas fa-users"></i>
                            </div>
                            <h4 class="card-title mb-3">WhatsApp Group</h4>
                            <p class="card-text text-muted mb-3">Join our discussion group to connect with other students and share resources.</p>
                            <div class="mt-4">
                                <button type="button" class="btn btn-success btn-lg w-100 pin-protected-btn" data-url="https://chat.whatsapp.com/EUUAMqXqkFFFi4OvOPbysW?mode=gi_t">
                                    <i class="fab fa-whatsapp"></i> Join Group
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- WhatsApp Channel Card -->
                <div class="col-md-6">
                    <div class="card whatsapp-card h-100 border-0 shadow-sm hover-lift" style="cursor: pointer;">
                        <div class="card-body text-center py-5">
                            <div style="font-size: 3rem; color: #25D366; margin-bottom: 1rem;">
                                <i class="fas fa-broadcast-tower"></i>
                            </div>
                            <h4 class="card-title mb-3">WhatsApp Channel</h4>
                            <p class="card-text text-muted mb-3">Subscribe to our channel for official updates, announcements, and important notices.</p>
                            <div class="mt-4">
                                <button type="button" class="btn btn-success btn-lg w-100 pin-protected-btn" data-url="https://whatsapp.com/channel/0029Vb7ZRhrChq6Gg2I2GP2H">
                                    <i class="fab fa-whatsapp"></i> Subscribe Channel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Additional Info Section -->
            <div class="card border-0 shadow-sm mb-4" style="background: linear-gradient(135deg, rgba(37, 211, 102, 0.05) 0%, rgba(23, 162, 184, 0.05) 100%);">
                <div class="card-body">
                    <h5 class="card-title mb-3"><i class="fas fa-info-circle text-primary"></i> Why Join?</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><i class="fas fa-check text-success"></i> <strong>Get Instant Updates</strong> - Never miss important announcements</li>
                        <li class="mb-2"><i class="fas fa-check text-success"></i> <strong>Share Resources</strong> - Connect with peers and share study materials</li>
                        <li class="mb-2"><i class="fas fa-check text-success"></i> <strong>Direct Support</strong> - Get help from admins and moderators</li>
                        <li class="mb-2"><i class="fas fa-check text-success"></i> <strong>Community Events</strong> - Stay updated on group activities and events</li>
                    </ul>
                </div>
            </div>

            <!-- Back Button -->
            <div class="text-center">
                <a href="javascript:history.back()" class="btn btn-outline-primary btn-lg">
                    <i class="fas fa-arrow-left"></i> Go Back
                </a>
            </div>
        </div>
    </div>
</div>

<style>
    .whatsapp-card {
        border: 2px solid rgba(37, 211, 102, 0.1);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .whatsapp-card:hover {
        border-color: #25D366;
        box-shadow: 0 12px 32px rgba(37, 211, 102, 0.2) !important;
    }

    .btn-success {
        background: linear-gradient(135deg, #25D366 0%, #1DB44B 100%);
        border: none;
        font-weight: 700;
        box-shadow: 0 4px 12px rgba(37, 211, 102, 0.2);
    }

    .btn-success:hover {
        background: linear-gradient(135deg, #1DB44B 0%, #0D7A3B 100%);
        box-shadow: 0 8px 24px rgba(37, 211, 102, 0.3);
        transform: translateY(-2px);
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function(){
    var pendingUrl = null;

    // PIN protected buttons
    document.querySelectorAll('.pin-protected-btn').forEach(function(btn){
        btn.addEventListener('click', function(e){
            e.preventDefault();
            pendingUrl = this.getAttribute('data-url');
            var pinModalEl = document.getElementById('pinModal');
            var pinModal = new bootstrap.Modal(pinModalEl);
            document.getElementById('pinInput').value = '';
            document.getElementById('pinError').classList.add('d-none');
            pinModal.show();
        });
    });

    // PIN submission handler
    document.getElementById('pinSubmitBtn').addEventListener('click', function(){
        var pin = document.getElementById('pinInput').value || '';
        var pinError = document.getElementById('pinError');
        var pinModalEl = document.getElementById('pinModal');
        var pinModal = bootstrap.Modal.getInstance(pinModalEl) || new bootstrap.Modal(pinModalEl);
        
        fetch('/validate-pin/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({pin: pin})
        })
        .then(response => response.json())
        .then(data => {
            if(data.valid){
                pinError.classList.add('d-none');
                try { pinModal.hide(); } catch(e) {}
                if(pendingUrl){
                    window.open(pendingUrl, '_blank');
                }
                pendingUrl = null;
            } else {
                pinError.textContent = 'Wrong password';
                pinError.classList.remove('d-none');
            }
        })
        .catch(err => {
            pinError.textContent = 'Error validating PIN';
            pinError.classList.remove('d-none');
        });
    });

    // Allow pressing Enter in PIN input
    document.getElementById('pinInput').addEventListener('keypress', function(e){
        if(e.key === 'Enter'){
            document.getElementById('pinSubmitBtn').click();
        }
    });
});
</script>
{% endblock %}
